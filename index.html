<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kurmi Match ‚Äî Profiles + Swipe</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#e5e7eb; --muted:#94a3b8; --bg:#0b1220; --card:rgba(255,255,255,0.06); --brand:#6366f1; --line:rgba(255,255,255,.08)}
    html,body{height:100%}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:radial-gradient(1200px 600px at 20% -20%, rgba(99,102,241,.25), transparent 60%), radial-gradient(900px 500px at 110% 10%, rgba(16,185,129,.18), transparent 60%), linear-gradient(180deg,#0a0f1f,#0b1220)}
    .glass{background:var(--card); backdrop-filter: blur(10px); border:1px solid var(--line)}
    .chip{border:1px solid var(--line)}
    .shadow-glow{box-shadow:0 10px 30px rgba(99,102,241,.15)}
    .line-clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>
<body class="min-h-screen">
  <header class="sticky top-0 z-30 glass">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center gap-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-indigo-500/20 border border-indigo-400/30">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21L12 3l9.75 18M12 3v18"/></svg>
        </div>
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight">Kurmi Match</h1>
          <p class="text-xs text-slate-400 -mt-1">Community Matrimony ‚Ä¢ Profiles + Swipe</p>
        </div>
      </div>
      <div class="flex-1">
        <div class="relative max-w-xl mx-auto">
          <input id="search" class="w-full glass rounded-xl py-2.5 pl-10 pr-12 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/60" placeholder="Search by name, city, state, profession..." />
          <svg class="absolute left-3 top-2.5 h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15Z"/></svg>
          <button id="clearSearch" class="absolute right-2 top-1.5 px-2 py-1 text-xs rounded-lg chip hover:bg-white/10">Clear</button>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="favoritesBtn" class="chip rounded-xl px-3 py-2 text-sm hover:bg-white/10">‚òÖ Favourites <span id="favCount" class="ml-1 text-indigo-300">0</span></button>
        <button id="addProfileBtn" class="rounded-xl px-4 py-2 text-sm font-semibold bg-indigo-500 hover:bg-indigo-400 text-white shadow-glow">+ Add Profile</button>
        <button id="swipeBtn" class="rounded-xl px-4 py-2 text-sm font-semibold bg-emerald-500 hover:bg-emerald-400 text-white shadow-glow">‚ù§ Swipe</button>
        <button id="matchesBtn" class="chip rounded-xl px-3 py-2 text-sm hover:bg-white/10">üí¨ Matches <span id="matchCount" class="ml-1 text-indigo-300">0</span></button>
      </div>
    </div>
  </header>

  <section class="glass border-y border-slate-700/40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 grid sm:grid-cols-2 lg:grid-cols-6 gap-3">
      <div><label class="block text-xs text-slate-400 mb-1">Gender</label>
        <select id="gender" class="w-full chip rounded-lg px-3 py-2 bg-transparent"><option value="">Any</option><option>Female</option><option>Male</option><option>Other</option></select>
      </div>
      <div><label class="block text-xs text-slate-400 mb-1">Marital Status</label>
        <select id="marital" class="w-full chip rounded-lg px-3 py-2 bg-transparent"><option value="">Any</option><option>Never Married</option><option>Divorced</option><option>Widowed</option></select>
      </div>
      <div><label class="block text-xs text-slate-400 mb-1">State</label>
        <select id="state" class="w-full chip rounded-lg px-3 py-2 bg-transparent"></select>
      </div>
      <div><label class="block text-xs text-slate-400 mb-1">Education</label>
        <select id="education" class="w-full chip rounded-lg px-3 py-2 bg-transparent"><option value="">Any</option><option>MBBS</option><option>MD/MS</option><option>B.Tech</option><option>M.Tech</option><option>MBA</option><option>B.Sc</option><option>M.Sc</option></select>
      </div>
      <div><label class="block text-xs text-slate-400 mb-1">Age Range</label>
        <div class="flex items-center gap-2"><input id="ageMin" type="number" min="18" max="70" value="21" class="w-20 chip rounded-lg px-2 py-2 bg-transparent" /><span class="text-slate-400">‚Äì</span><input id="ageMax" type="number" min="18" max="70" value="33" class="w-20 chip rounded-lg px-2 py-2 bg-transparent" /></div>
      </div>
      <div><label class="block text-xs text-slate-400 mb-1">Sort by</label>
        <select id="sortBy" class="w-full chip rounded-lg px-3 py-2 bg-transparent"><option value="new">Newest</option><option value="ageAsc">Age ‚Üë</option><option value="ageDesc">Age ‚Üì</option><option value="name">Name A‚ÜíZ</option></select>
      </div>
    </div>
  </section>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="glass rounded-2xl p-4"><p class="text-slate-400 text-xs">Total Profiles</p><p class="text-2xl font-bold" id="statTotal">‚Äî</p></div>
      <div class="glass rounded-2xl p-4"><p class="text-slate-400 text-xs">Filtered Results</p><p class="text-2xl font-bold" id="statFiltered">‚Äî</p></div>
      <div class="glass rounded-2xl p-4"><p class="text-slate-400 text-xs">Favourites</p><p class="text-2xl font-bold" id="statFav">‚Äî</p></div>
      <div class="glass rounded-2xl p-4"><p class="text-slate-400 text-xs">Showing</p><p class="text-2xl font-bold"><span id="statShowing">0</span> / <span id="statFiltered2">0</span></p></div>
    </div>

    <div id="activeChips" class="flex flex-wrap gap-2 mb-6"></div>

    <section id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></section>

    <div class="mt-8 flex items-center justify-center gap-3">
      <button id="prevPage" class="chip px-4 py-2 rounded-xl disabled:opacity-40">Prev</button>
      <span class="text-sm text-slate-400">Page <span id="pageNum">1</span></span>
      <button id="nextPage" class="chip px-4 py-2 rounded-xl disabled:opacity-40">Next</button>
    </div>
  </main>

  <!-- Swipe Mode -->
  <section id="swipeWrap" class="hidden max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-xl font-bold">Swipe Matches</h2>
      <button id="closeSwipe" class="chip rounded-lg px-3 py-1">‚úï Close</button>
    </div>
    <div class="relative h-[520px]">
      <div id="swipeStack" class="absolute inset-0"></div>
      <div class="absolute -bottom-4 left-0 right-0 flex items-center justify-center gap-4">
        <button id="passBtn" class="rounded-full chip w-14 h-14 text-2xl">‚úñ</button>
        <button id="likeBtn" class="rounded-full w-16 h-16 text-2xl bg-pink-500 hover:bg-pink-400 text-white shadow-glow">‚ù§</button>
      </div>
    </div>
  </section>

  <!-- Match Modal -->
  <div id="matchModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
    <div class="glass rounded-2xl max-w-md w-full p-6 text-center">
      <h3 class="text-2xl font-extrabold">It's a match! ‚ù§</h3>
      <p id="matchText" class="text-slate-300 mt-2"></p>
      <div class="mt-5 flex items-center justify-center gap-3">
        <button id="matchClose" class="chip rounded-lg px-3 py-2">Keep Swiping</button>
        <button id="openMatchesFromMatch" class="rounded-lg px-4 py-2 bg-emerald-500 hover:bg-emerald-400 text-white">Open Matches</button>
      </div>
    </div>
  </div>

  <!-- Matches Modal -->
  <div id="matchesModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
    <div class="glass rounded-2xl max-w-2xl w-full p-0 overflow-hidden">
      <div class="p-6">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">Your Matches</h3>
          <button id="closeMatches" class="chip rounded-lg px-2 py-1">‚úï</button>
        </div>
        <div id="matchesList" class="grid sm:grid-cols-2 gap-4 mt-4"></div>
      </div>
    </div>
  </div>

  <!-- Add Profile Modal -->
  <div id="addModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
    <div class="glass rounded-2xl max-w-2xl w-full p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Add New Profile</h3>
        <button id="closeAdd" class="chip rounded-lg px-2 py-1">‚úï</button>
      </div>
      <form id="addForm" class="grid sm:grid-cols-2 gap-4">
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="name" placeholder="Full Name" required />
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="age" type="number" min="18" max="70" placeholder="Age" required />
        <select class="chip rounded-lg px-3 py-2 bg-transparent" name="gender" required>
          <option value="">Gender</option><option>Female</option><option>Male</option><option>Other</option>
        </select>
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="state" placeholder="State" required />
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="city" placeholder="City" required />
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="education" placeholder="Education (e.g., MBBS)" />
        <input class="chip rounded-lg px-3 py-2 bg-transparent" name="profession" placeholder="Profession" />
        <select class="chip rounded-lg px-3 py-2 bg-transparent" name="marital" required>
          <option value="">Marital Status</option><option>Never Married</option><option>Divorced</option><option>Widowed</option>
        </select>
        <input class="chip rounded-lg px-3 py-2 bg-transparent col-span-full" name="photo" placeholder="Photo URL (optional)" />
        <textarea class="chip rounded-lg px-3 py-2 bg-transparent col-span-full" name="about" rows="3" placeholder="About"></textarea>
        <div class="col-span-full flex items-center justify-end gap-3 mt-2">
          <button type="button" id="resetForm" class="chip rounded-lg px-3 py-2">Reset</button>
          <button class="rounded-lg px-4 py-2 bg-indigo-500 hover:bg-indigo-400 text-white">Save</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16 text-center text-slate-500 text-sm">
    <hr class="border-slate-700/40 mb-4">
    <p>Starter template with Tinder-style swipe, local matches & favourites. Plug into Firebase for auth & real data.</p>
  </footer>

<script>
  const SAMPLE_STATES = ["Bihar","Uttar Pradesh","Madhya Pradesh","Jharkhand","Chhattisgarh","Maharashtra","Delhi","Gujarat","Rajasthan","West Bengal"];
  const SAMPLE_PROFILES = [
    {id:"GKM1001", name:"Priya Kumari", age:25, gender:"Female", state:"Bihar", city:"Patna", education:"MBBS", profession:"Doctor", marital:"Never Married", photo:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1200&auto=format&fit=crop", about:"Caring, family-oriented, enjoys classical music and volunteering.", createdAt: 1724880000, contactMasked:"pr***@mail.com / 98******21"},
    {id:"GKM1002", name:"Ankit Kumar", age:28, gender:"Male", state:"Uttar Pradesh", city:"Lucknow", education:"B.Tech", profession:"Software Engineer", marital:"Never Married", photo:"https://images.unsplash.com/photo-1603741583807-47e4a3b9c49a?q=80&w=1200&auto=format&fit=crop", about:"Tech enthusiast, foodie, and long-distance runner.", createdAt: 1724793600, contactMasked:"an***@mail.com / 88******12"},
    {id:"GKM1003", name:"Sneha Verma", age:26, gender:"Female", state:"Madhya Pradesh", city:"Bhopal", education:"MBA", profession:"Product Manager", marital:"Never Married", photo:"https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=1200&auto=format&fit=crop", about:"Loves books, travel, and baking. Values empathy and growth.", createdAt: 1724707200, contactMasked:"sn***@mail.com / 79******45"},
    {id:"GKM1004", name:"Rohan Singh", age:31, gender:"Male", state:"Delhi", city:"Delhi", education:"M.Tech", profession:"Data Scientist", marital:"Never Married", photo:"https://images.unsplash.com/photo-1554151228-14d9def656e4?q=80&w=1200&auto=format&fit=crop", about:"Curious mind, enjoys chess and hiking weekends.", createdAt: 1724620800, contactMasked:"ro***@mail.com / 90******33"},
    {id:"GKM1005", name:"Nisha Patel", age:29, gender:"Female", state:"Gujarat", city:"Ahmedabad", education:"M.Sc", profession:"Pharmacist", marital:"Never Married", photo:"https://images.unsplash.com/photo-1517466787929-bc90951d0974?q=80&w=1200&auto=format&fit=crop", about:"Family-oriented, loves Garba and community service.", createdAt: 1724534400, contactMasked:"ni***@mail.com / 98******67"},
    {id:"GKM1006", name:"Aditya Sharma", age:30, gender:"Male", state:"Rajasthan", city:"Jaipur", education:"MBA", profession:"Consultant", marital:"Divorced", photo:"https://images.unsplash.com/photo-1531123897727-8f129e1688ce?q=80&w=1200&auto=format&fit=crop", about:"Practical, honest, enjoys cricket and travel.", createdAt: 1724448000, contactMasked:"ad***@mail.com / 87******90"},
    {id:"GKM1007", name:"Ritika Singh", age:24, gender:"Female", state:"Uttar Pradesh", city:"Varanasi", education:"B.Sc", profession:"Teacher", marital:"Never Married", photo:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1200&auto=format&fit=crop", about:"Creative, spiritual, loves painting and river walks.", createdAt: 1724361600, contactMasked:"ri***@mail.com / 96******22"},
    {id:"GKM1008", name:"Saurabh Kumar", age:33, gender:"Male", state:"Bihar", city:"Gaya", education:"B.Tech", profession:"Civil Engineer", marital:"Never Married", photo:"https://images.unsplash.com/photo-1527980965255-d3b416303d12?q=80&w=1200&auto=format&fit=crop", about:"Ambitious, grounded, enjoys badminton and cooking.", createdAt: 1724275200, contactMasked:"sa***@mail.com / 85******19"},
    {id:"GKM1009", name:"Pooja Mishra", age:27, gender:"Female", state:"Jharkhand", city:"Ranchi", education:"M.Tech", profession:"Researcher", marital:"Never Married", photo:"https://images.unsplash.com/photo-1520975682031-2014dd7d4a2a?q=80&w=1200&auto=format&fit=crop", about:"Problem-solver, animal lover, weekend treks.", createdAt: 1724188800, contactMasked:"po***@mail.com / 93******11"},
    {id:"GKM1010", name:"Aman Verma", age:26, gender:"Male", state:"Maharashtra", city:"Pune", education:"B.Sc", profession:"Marketing Executive", marital:"Never Married", photo:"https://images.unsplash.com/photo-1527980965255-d3b416303d12?q=80&w=1200&auto=format&fit=crop", about:"Optimistic, social, loves football and cafes.", createdAt: 1724102400, contactMasked:"am***@mail.com / 91******77"},
    {id:"GKM1011", name:"Neha Gupta", age:32, gender:"Female", state:"Chhattisgarh", city:"Raipur", education:"MD/MS", profession:"Surgeon", marital:"Divorced", photo:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1200&auto=format&fit=crop", about:"Compassionate, fitness-focused, classical dance.", createdAt: 1724016000, contactMasked:"ne***@mail.com / 95******88"},
    {id:"GKM1012", name:"Kunal Singh", age:29, gender:"Male", state:"West Bengal", city:"Kolkata", education:"MBA", profession:"Banker", marital:"Never Married", photo:"https://images.unsplash.com/photo-1554151228-14d9def656e4?q=80&w=1200&auto=format&fit=crop", about:"Calm, responsible, enjoys poetry and street food.", createdAt: 1723929600, contactMasked:"ku***@mail.com / 94******55"}
  ];

  const el = (id)=>document.getElementById(id);
  const grid = el('grid');

  const state = {
    all: [],
    filtered: [],
    favourites: new Set(JSON.parse(localStorage.getItem('favourites')||'[]')),
    page: 1,
    pageSize: 12,
    lastQuery: '',
    likes: new Set(JSON.parse(localStorage.getItem('likes')||'[]')),
    likedYou: new Set(JSON.parse(localStorage.getItem('likedYou')||'[]')),
    matches: new Set(JSON.parse(localStorage.getItem('matches')||'[]')),
    swipeOrder: [],
    swipePtr: 0
  };

  function byId(id){return state.all.find(p=>p.id===id)}
  function saveMatchState(){
    localStorage.setItem('likes', JSON.stringify([...state.likes]));
    localStorage.setItem('likedYou', JSON.stringify([...state.likedYou]));
    localStorage.setItem('matches', JSON.stringify([...state.matches]));
  }
  function updateStats(){
    el('statTotal').textContent = state.all.length;
    el('statFiltered').textContent = state.filtered.length;
    el('statFiltered2').textContent = state.filtered.length;
    el('statFav').textContent = state.favourites.size;
    const showing = Math.min(state.page*state.pageSize, state.filtered.length);
    el('statShowing').textContent = showing;
    el('favCount').textContent = state.favourites.size;
    el('matchCount').textContent = state.matches.size;
  }

  function chip(text, onRemove){
    const b = document.createElement('button');
    b.className = 'chip rounded-full px-3 py-1 text-xs text-slate-300 hover:bg-white/10';
    b.innerHTML = `${text} <span class="ml-1 text-slate-500">‚úï</span>`;
    b.onclick = onRemove; return b;
  }
  function updateActiveChips(){
    const wrap = el('activeChips');
    wrap.innerHTML = '';
    const q = el('search').value.trim();
    const rm = () => { el('search').value=''; applyFilters(); };
    if(q) wrap.appendChild(chip(`Search: ${q}`, rm));
    const gender = el('gender').value; if(gender) wrap.appendChild(chip(`Gender: ${gender}`, ()=>{el('gender').value=''; applyFilters();}));
    const marital = el('marital').value; if(marital) wrap.appendChild(chip(`Marital: ${marital}`, ()=>{el('marital').value=''; applyFilters();}));
    const st = el('state').value; if(st) wrap.appendChild(chip(`State: ${st}`, ()=>{el('state').value=''; applyFilters();}));
    const edu = el('education').value; if(edu) wrap.appendChild(chip(`Education: ${edu}`, ()=>{el('education').value=''; applyFilters();}));
    const a1 = +el('ageMin').value, a2 = +el('ageMax').value; if(a1||a2) wrap.appendChild(chip(`Age: ${a1}-${a2}`, ()=>{el('ageMin').value='21'; el('ageMax').value='33'; applyFilters();}));
  }

  function card(p){
    const fav = state.favourites.has(p.id);
    const div = document.createElement('article');
    div.className = 'glass rounded-2xl overflow-hidden hover:-translate-y-0.5 transition-transform';
    div.innerHTML = `
      <div class="relative">
        <img src="${p.photo}" alt="${p.name}" class="w-full h-48 object-cover"/>
        <button data-fav="${p.id}" class="absolute top-3 right-3 chip rounded-full px-3 py-1 text-xs ${fav?'bg-yellow-400/20 text-yellow-300':''}">${fav?'‚òÖ':'‚òÜ'}</button>
      </div>
      <div class="p-4">
        <h3 class="text-lg font-bold">${p.name}</h3>
        <p class="text-slate-400 text-sm">${p.age} ‚Ä¢ ${p.gender} ‚Ä¢ ${p.city}, ${p.state}</p>
        <p class="text-slate-300 text-sm mt-1 truncate"><span class="text-slate-400">${p.education}</span> ‚Ä¢ ${p.profession||'‚Äî'}</p>
        <div class="mt-3 flex items-center gap-2">
          <span class="chip rounded-full px-2 py-1 text-xs">Kurmi</span>
          <span class="chip rounded-full px-2 py-1 text-xs">${p.marital}</span>
        </div>
        <div class="mt-4 flex items-center gap-2">
          <button data-view="${p.id}" class="rounded-lg px-3 py-2 bg-indigo-500 hover:bg-indigo-400 text-white text-sm">View</button>
          <button data-contact="${p.id}" class="chip rounded-lg px-3 py-2 text-sm">Contact</button>
        </div>
      </div>`;
    div.querySelector(`[data-view="${p.id}"]`).onclick = ()=>openView(p.id);
    div.querySelector(`[data-contact="${p.id}"]`).onclick = ()=>revealContact(p);
    div.querySelector(`[data-fav="${p.id}"]`).onclick = ()=>toggleFav(p.id);
    return div;
  }

  function render(profiles){
    grid.innerHTML = '';
    const {page,pageSize} = state; const start= (page-1)*pageSize, end=Math.min(profiles.length, page*pageSize);
    const showing = profiles.slice(start,end);
    showing.forEach(p=>grid.appendChild(card(p)));
    el('pageNum').textContent = state.page;
    el('prevPage').disabled = state.page===1;
    el('nextPage').disabled = end>=profiles.length;
    updateStats();
  }

  function revealContact(p){ alert(`Contact (masked): ${p.contactMasked}\n\nConnect after both sides express interest.`); }
  function toggleFav(id){ if(state.favourites.has(id)) state.favourites.delete(id); else state.favourites.add(id); localStorage.setItem('favourites', JSON.stringify([...state.favourites])); applyFilters(); }

  function openView(id){
    const p = byId(id); if(!p) return;
    alert(`${p.name} ‚Äî ${p.age}, ${p.gender} ‚Äî ${p.city}, ${p.state}`);
  }

  // Swipe / Match
  function buildSwipeOrder(){ state.swipeOrder = state.filtered.map(p=>p.id); state.swipePtr = 0; renderSwipeCard(); }
  function swipeCardTemplate(p){
    return `
    <div class="absolute inset-0 will-change-transform transition-transform duration-200 select-none" data-card="${p.id}">
      <div class="glass rounded-3xl overflow-hidden h-full">
        <img src='${p.photo}' alt='${p.name}' class="w-full h-3/5 object-cover"/>
        <div class="p-5">
          <div class="flex items-center justify-between">
            <h3 class="text-2xl font-extrabold">${p.name}</h3>
            <span class="chip rounded-full px-2 py-1 text-xs">${p.age} ‚Ä¢ ${p.gender}</span>
          </div>
          <p class="text-slate-400 text-sm">${p.city}, ${p.state}</p>
          <p class="text-slate-300 text-sm mt-2"><span class="text-slate-400">${p.education}</span> ‚Ä¢ ${p.profession||'‚Äî'}</p>
          <p class="mt-3 line-clamp-3">${p.about||''}</p>
        </div>
      </div>
    </div>`;
  }
  function renderSwipeCard(){
    const wrap = el('swipeStack'); wrap.innerHTML = '';
    for(let i=state.swipePtr;i<Math.min(state.swipePtr+3,state.swipeOrder.length);i++){
      const id = state.swipeOrder[i]; const p = byId(id); if(!p) continue;
      const z = 100 - (i-state.swipePtr);
      const container = document.createElement('div'); container.innerHTML = swipeCardTemplate(p);
      const root = container.firstElementChild; root.style.zIndex=z; root.style.transform = `translateY(${(i-state.swipePtr)*8}px) scale(${1-(i-state.swipePtr)*0.04})`;
      let startX=0, dx=0; const elc = root.querySelector('[data-card]');
      const onMove = e=>{ if(!startX) return; dx = (e.touches?e.touches[0].clientX:e.clientX) - startX; elc.style.transform = `translate(${dx}px,0) rotate(${dx/20}deg)`; };
      const onEnd = ()=>{ document.removeEventListener('mousemove', onMove); document.removeEventListener('touchmove', onMove); if(Math.abs(dx)>120){ dx>0?likeCurrent():passCurrent(); } else { elc.style.transform = 'translate(0,0) rotate(0)'; } startX=0; dx=0; };
      root.addEventListener('mousedown', e=>{startX=e.clientX; document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onEnd,{once:true});});
      root.addEventListener('touchstart', e=>{startX=e.touches[0].clientX; document.addEventListener('touchmove', onMove); document.addEventListener('touchend', onEnd,{once:true});});
      wrap.appendChild(root);
    }
    updateStats();
  }
  function showMatch(id){ const p = byId(id); if(!p) return; el('matchText').textContent = `You and ${p.name} liked each other. You can now share contacts.`; document.getElementById('matchModal').classList.remove('hidden'); document.getElementById('matchModal').classList.add('flex'); }
  function likeCurrent(){ const id = state.swipeOrder[state.swipePtr]; if(!id) return; state.likes.add(id); if(state.likedYou.has(id)){ state.matches.add(id); showMatch(id);} saveMatchState(); state.swipePtr++; renderSwipeCard(); }
  function passCurrent(){ state.swipePtr++; renderSwipeCard(); }
  function openMatches(){ const list = el('matchesList'); list.innerHTML=''; [...state.matches].forEach(id=>{ const p = byId(id); if(!p) return; const card=document.createElement('div'); card.className='glass rounded-2xl overflow-hidden'; card.innerHTML = `<img src='${p.photo}' class='w-full h-40 object-cover'/>\n<div class='p-3'>\n  <h4 class='font-semibold'>${p.name}</h4>\n  <p class='text-slate-400 text-sm'>${p.city}, ${p.state}</p>\n  <button class='mt-3 rounded-lg px-3 py-2 bg-emerald-500 hover:bg-emerald-400 text-white text-sm' data-reveal='${p.id}'>Reveal Contact</button>\n</div>`; list.appendChild(card); }); document.getElementById('matchesModal').classList.remove('hidden'); document.getElementById('matchesModal').classList.add('flex'); updateStats(); }

  function applyFilters(){
    const q = el('search').value.trim().toLowerCase();
    const gender = el('gender').value; const marital = el('marital').value; const st = el('state').value; const edu = el('education').value;
    const a1 = +el('ageMin').value || 18; const a2 = +el('ageMax').value || 70; const sort = el('sortBy').value;
    let arr = state.all.filter(p=>{ const inQuery = !q || [p.name,p.city,p.state,p.profession,p.education].filter(Boolean).some(v=>v.toLowerCase().includes(q)); const inGender=!gender||p.gender===gender; const inMarital=!marital||p.marital===marital; const inState=!st||p.state===st; const inEdu=!edu||p.education===edu; const inAge=(p.age>=a1&&p.age<=a2); return inQuery&&inGender&&inMarital&&inState&&inEdu&&inAge; });
    if(sort==='new') arr.sort((a,b)=>b.createdAt - a.createdAt); if(sort==='ageAsc') arr.sort((a,b)=>a.age-b.age); if(sort==='ageDesc') arr.sort((a,b)=>b.age-a.age); if(sort==='name') arr.sort((a,b)=>a.name.localeCompare(b.name));
    state.filtered = arr; state.page=1; updateActiveChips(); render(state.filtered); buildSwipeOrder();
  }

  function initStates(){ const s = el('state'); s.innerHTML = '<option value="">Any</option>' + SAMPLE_STATES.map(x=>`<option>${x}</option>`).join(''); }
  function loadAll(){ const user = JSON.parse(localStorage.getItem('userProfiles')||'[]'); state.all = [...SAMPLE_PROFILES, ...user].map(p=>({...p, createdAt: p.createdAt || Math.floor(Date.now()/1000) - Math.floor(Math.random()*86400*14)})); if(state.likedYou.size===0){ const ids = state.all.map(p=>p.id); for(const id of ids){ if(Math.random()<0.15) state.likedYou.add(id);} saveMatchState(); } }
  function saveUserProfiles(){ const onlyUser = state.all.filter(p=>String(p.id).startsWith('U-')); localStorage.setItem('userProfiles', JSON.stringify(onlyUser)); }

  window.addEventListener('DOMContentLoaded', ()=>{
    initStates(); loadAll(); applyFilters();
    el('search').addEventListener('input', ()=>applyFilters()); el('clearSearch').onclick = ()=>{el('search').value=''; applyFilters();};
    ['gender','marital','state','education','ageMin','ageMax','sortBy'].forEach(id=>{ el(id).addEventListener('change', applyFilters)});
    el('prevPage').onclick = ()=>{ if(state.page>1){ state.page--; render(state.filtered);} };
    el('nextPage').onclick = ()=>{ const max = Math.ceil(state.filtered.length/state.pageSize); if(state.page<max){ state.page++; render(state.filtered);} };

    el('addProfileBtn').onclick = ()=>{ document.getElementById('addModal').classList.remove('hidden'); document.getElementById('addModal').classList.add('flex'); };
    el('closeAdd').onclick = ()=>{ document.getElementById('addModal').classList.add('hidden'); };
    el('resetForm').onclick = ()=>el('addForm').reset();
    el('addForm').onsubmit = (e)=>{ e.preventDefault(); const f=new FormData(e.target); const id=`U-${Math.random().toString(36).slice(2,8).toUpperCase()}`; const p={id,name:f.get('name').trim(),age:+f.get('age'),gender:f.get('gender'),state:f.get('state').trim(),city:f.get('city').trim(),education:f.get('education').trim(),profession:f.get('profession').trim(),marital:f.get('marital'),photo:f.get('photo').trim()||'https://images.unsplash.com/photo-1531123897727-8f129e1688ce?q=80&w=1200&auto=format&fit=crop',about:f.get('about').trim(),createdAt:Math.floor(Date.now()/1000),contactMasked:'user-submitted (hidden)'}; state.all.unshift(p); saveUserProfiles(); document.getElementById('addModal').classList.add('hidden'); applyFilters(); };

    // Swipe UI & Shortcuts
    el('swipeBtn').onclick = ()=>{ el('swipeWrap').classList.remove('hidden'); window.scrollTo({top:0,behavior:'smooth'}); buildSwipeOrder(); };
    el('closeSwipe').onclick = ()=>{ el('swipeWrap').classList.add('hidden'); };
    el('likeBtn').onclick = likeCurrent; el('passBtn').onclick = passCurrent;
    document.addEventListener('keydown', (e)=>{ if(el('swipeWrap').classList.contains('hidden')) return; if(e.key==='ArrowRight') likeCurrent(); if(e.key==='ArrowLeft') passCurrent(); });

    // Matches
    document.getElementById('matchClose').onclick = ()=>{ document.getElementById('matchModal').classList.add('hidden'); };
    document.getElementById('openMatchesFromMatch').onclick = ()=>{ document.getElementById('matchModal').classList.add('hidden'); openMatches(); };
    el('matchesBtn').onclick = openMatches; el('closeMatches').onclick = ()=>{ document.getElementById('matchesModal').classList.add('hidden'); };
    el('matchesList').addEventListener('click', (e)=>{ const id = e.target.getAttribute('data-reveal'); if(id){ revealContact(byId(id)); }});
  });
</script>
</body>
</html>

